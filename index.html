<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLA Angle Calculator</title>
    <link rel="stylesheet" href="vendor/pico.min.css">
    <link rel="stylesheet" href="css/app.css">
    <script defer src="vendor/alpine.min.js"></script>
    <script defer src="js/app.js"></script>
</head>
<body>
    <main class="container" x-data="calculator" x-cloak>
        <header>
            <h1>SLA Angle Calculator</h1>
            <p>Based on the original calculator by RC87</p>
        </header>

        <section class="printer-selector">
            <label for="printer-search">Select Printer</label>
            <div class="dropdown-wrapper">
                <input
                    id="printer-search"
                    type="text"
                    x-model="searchQuery"
                    @focus="openDropdown()"
                    @blur.debounce.200ms="closeDropdown()"
                    @keydown="handleKeydown($event)"
                    @input="resetHighlightOnSearch()"
                    :placeholder="selectedPrinter ? '' : 'Search printers...'"
                    :value="selectedPrinter && !dropdownOpen ? selectedPrinter.manufacturer + ' ' + selectedPrinter.model : searchQuery"
                    autocomplete="off"
                    role="combobox"
                    aria-haspopup="listbox"
                    :aria-expanded="dropdownOpen"
                    aria-controls="printer-listbox"
                />
                <ul x-show="dropdownOpen" x-cloak x-ref="dropdownList" id="printer-listbox" role="listbox" class="dropdown-list">
                    <template x-if="loading">
                        <li class="dropdown-item loading" role="option">Loading printers...</li>
                    </template>
                    <template x-if="jsonError">
                        <li class="dropdown-item error" role="option" x-text="jsonError"></li>
                    </template>
                    <template x-if="!loading && !jsonError && filteredPrinters.length === 0">
                        <li class="dropdown-item empty" role="option">No printers found</li>
                    </template>
                    <template x-for="(printer, index) in filteredPrinters" :key="printer.id">
                        <li
                            class="dropdown-item"
                            :class="{ 'highlighted': index === highlightedIndex }"
                            @mousedown.prevent="selectPrinter(printer)"
                            @mouseenter="highlightedIndex = index"
                            role="option"
                            :aria-selected="index === highlightedIndex"
                        >
                            <span class="printer-name" x-text="printer.manufacturer + ' ' + printer.model"></span>
                            <span class="pixel-info" x-text="printer.pixelX === printer.pixelY ? printer.pixelX + 'μm' : printer.pixelX + '×' + printer.pixelY + 'μm'"></span>
                        </li>
                    </template>
                </ul>
            </div>
        </section>

        <section class="manual-input" x-show="!selectedPrinter">
            <p class="hint">Or enter pixel size manually:</p>
            <div class="manual-fields">
                <div class="field">
                    <label for="manual-pixel-x">Pixel X (μm)</label>
                    <input id="manual-pixel-x" type="number" x-model.number="manualPixelX" min="1" max="200" step="0.1" />
                </div>
                <div class="field">
                    <label for="manual-pixel-y">Pixel Y (μm)</label>
                    <input id="manual-pixel-y" type="number" x-model.number="manualPixelY" min="1" max="200" step="0.1" />
                </div>
            </div>
        </section>

        <footer>
            <a href="impressum.html">Impressum</a>
        </footer>
    </main>
</body>
</html>
